<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<div th:fragment="centralDashboardLandingPage" th:remove="tag">
    <div class="row">
        <div class="col-md-12">
            <div class="lg-rectbox">
                <div class="lg-rectbox-header-darkblue">
                </div>
                <div class="lg-rectbox-body">
                    <h3 class="text-center lg-rectbox-heading margin-bottom-20" style="color:#5653ba"><span th:text="${currentYear}"></span> সালের মোট অভিযোগ নিষ্পত্তি </h3>
                    <div class="row">
                        <div class="col-sm-4 col-12 py-2">
                            <div class="md-rectbox-wide border-dark-blue">
                                <h1 class="col-sm-8 margin-top-10">মোট প্রাপ্ত অভিযোগ</h1><span style="color: #3b86ff;"> <button class="btn btn-type5 margin-top-5 font-lg bold" id="totalGrievanceYearly" type="button"></button></span>
                            </div>
                        </div>
                        <div class="col-sm-4 col-12 py-2">
                            <div class="md-rectbox-wide border-dark-blue">
                                <h1 class="col-sm-8 margin-top-10">নিষ্পত্তিকৃত অভিযোগ</h1><span style="color: #3b86ff;"> <button class="btn btn-type5 margin-top-5 font-lg bold" id="resolvedGrievanceYearly" type="button"></button></span>
                            </div>
                        </div>
                        <div class="col-sm-4 col-12 py-2">
                            <div class="md-rectbox-wide border-dark-blue">
                                <h1 class="col-sm-8 margin-top-10">অভিযোগ নিষ্পত্তির হার</h1> <span style="color: #3b86ff;"><button class="btn btn-type5 margin-top-5 font-lg bold" id="resolveRateYearly" type="button"></button></span>
                            </div>
                        </div>
                        <br>
                        <br>
                    </div>
                    <div class="text-center font-lg bold margin-top-20">* নিষ্পত্তিকৃত অভিযোগের সংখ্যায় পূর্ববর্তী বছরের অনিষ্পন্ন অভিযোগের জের অন্তর্ভুক্ত</div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <br>

    <div class="row">
        <div class="col-md-12">
            <div class="lg-rectbox">
                <div class="lg-rectbox-header-blue2">
                </div>
                <div class="lg-rectbox-body">
                    <h3 class="text-center lg-rectbox-heading bold margin-bottom-10" style="color:#5653ba"><span th:text="${currentMonthYear}"></span> মাসের সামগ্রিক চিত্র</h3>
                    <div class="row">
                        <div class="col-md-4 col-sm-6 col-12 py-2">
                            <div class="md-rectbox border-dark-blue">
                                <h3 class="text-center md-heading">প্রাপ্ত অভিযোগের অবস্থা</h3>
                                <div class="row">
                                    <div class="col-md-6 col-sm-6 col-12  text-center padding-right-5 py-2">
                                        <div class="sm-box-1 h-100">
                                            <h3 class="text-center sm-heading">বর্তমান মাসে প্রাপ্ত অভিযোগ</h3>
                                            <button type="button" id="totalGrievance" class="btn">০</button>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-sm-6 col-12  text-center padding-left-5 py-2">
                                        <div class="sm-box-1 h-100">
                                            <h3 class="text-center sm-heading">জের</h3>
                                            <button type="button" id="lastMonthAscertain" class="btn">০</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 col-sm-6 col-12  text-center padding-right-5 py-2">
                                        <div class="sm-box-1 h-100">
                                            <h3 class="text-center sm-heading">সময় অতিক্রান্ত</h3>
                                            <button type="button" id="timeExpiredGrievance" class="btn btn-type3">০</button>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-sm-6 col-12  text-center padding-left-5 py-2">
                                        <div class="sm-box-1 h-100">
                                            <h3 class="text-center sm-heading">নিষ্পত্তিকৃত অভিযোগ</h3>
                                            <button type="button" id="resolvedGrievance" class="btn btn-type3">০</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6 col-12 py-2">
                            <div class="md-rectbox border-dark-blue">
                                <h3 class="text-center md-heading">প্রাপ্ত আপিলসমূহের সামগ্রিক অবস্থা</h3>
                                <div class="row">
                                    <div class="col-md-6 col-sm-6 col-12  text-center padding-right-5 py-2">
                                        <div class="sm-box-1 h-100">
                                            <h3 class="text-center sm-heading">মোট আপিল</h3>
                                            <button type="button" id="totalAppeal" class="btn">০</button>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-sm-6 col-12  text-center padding-left-5 py-2">
                                        <div class="sm-box-1 h-100">
                                            <h3 class="text-center sm-heading">সময় অতিক্রান্ত</h3>
                                            <button type="button" id="timeExpiredAppeal" class="btn">০</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-12">
                                        <div class="sm-box-1 h-100 py-2 text-center sm-min-height2">
                                            <h3 class="text-center sm-heading">নিষ্পত্তিকৃত আপিল</h3>
                                            <button type="button" id="resolvedAppeal" class="btn btn-type3">০</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6 col-12 py-2">
                            <div class="md-rectbox2 border-assh py-2">
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-12">
                                        <div class="list-group right-list-group">
                                            <div class="list-group-item">
                                                <span class="list-icon"><img src="/assets/global/img/dashboard/apea_finish_icon.png"></span>অভিযোগ নিষ্পত্তির হার<span class="item-count">(<span id="grievanceResolveRate">০.০</span>%)</span>
                                            </div>
                                            <div class="list-group-item">
                                                <span class="list-icon"><img src="/assets/global/img/dashboard/appeal-resolve-rate.png"></span>আপিল নিষ্পত্তির হার<span class="item-count">(<span id="appealResolveRate">০.০</span>%)</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <br>
    <div class="row">
        <div class="text-center font-lg margin-bottom-10 bold">
            <span><span th:text="${currentYear}"></span> সালে সর্বাধিক অভিযোগ প্রাপ্ত ১০ টি সেবার তালিকা</span>
        </div>
        <div class="md-rectbox2">
            <table class="table top-n-grievances table-striped table-bordered table-hover">
                <thead>
                <tr>
                    <th class="text-center">ক্রমিক</th>
                    <th class='text-center'>সেবার নাম</th>
                    <th class='text-center'>অভিযোগের সংখ্যা</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <br>
    <br>
    <div class="row">
        <div class="text-center font-lg margin-bottom-10 bold">
            <span> <span th:text="${currentMonthYear}"></span> মাসের মন্ত্রণালয়/বিভাগ ভিত্তিক তালিকা </span>
        </div>

        <div class="md-rectbox2">
            <table id="ministryOfficesStatistics" class="table table-striped table-bordered table-hover">
                <thead>
                <tr>
                    <th class="text-center" rowspan="2"> ক্রমিক </th>
                    <th class="text-center" rowspan="2"> মন্ত্রণালয়/বিভাগের নাম </th>
                    <th class="text-center" colspan="3"> মন্ত্রণালয়/বিভাগের অভিযোগ </th>
                    <th class="text-center" colspan="3"> আওতাধীন দপ্তরের মোট অভিযোগ </th>
                </tr>
                <tr>
                    <th class="text-center">মোট অভিযোগ</th>
                    <th class="text-center">অভিযোগ নিষ্পত্তির হার</th>
                    <th class="text-center">সময় অতিক্রান্ত অভিযোগ</th>
                    <th class="text-center">মোট অভিযোগ</th>
                    <th class="text-center">অভিযোগ নিষ্পত্তির হার</th>
                    <th class="text-center">সময় অতিক্রান্ত অভিযোগ</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div class="modal" id="modalOfficeWiseGrievanceCountForService" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title font-blue text-center">
                        <span class="bold">সেবার নাম: </span>
                        <span class="title-service-name"></span>
                    </h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                </div>
                <div th:classappend="${!isMobileLogin ? 'modal-body' : ''}">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover">
                            <thead>
                            <tr>
                                <th class="text-center"> ক্রমিক </th>
                                <th class="text-center"> দপ্তর </th>
                                <th class="text-center"> অভিযোগের সংখ্যা </th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn dark btn-outline" data-dismiss="modal" style="cursor: pointer;">বন্ধ করুন</button>
                </div>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript" th:fragment="centralDashboardLandingPageScript">

    function loadYearlyDashboardData(){
        blockUI();
        $.getJSON("/api/dashboard/yearly-data", function (response) {
            var rate = -1;
            // var exactTotal = response.totalComplaint - response.totalForwarded;
            var exactDecided = response.totalResolved + response.totalForwarded;
            if(response.totalComplaint > 0){
                var result = (exactDecided / response.totalComplaint)*100;
                rate = Math.round(result * 100) / 100;
            }
            $("#totalGrievanceYearly").text(("" + response.totalComplaint).toBanglaNumber());
            $("#resolvedGrievanceYearly").text(("" + response.totalResolved).toBanglaNumber());
            $("#resolveRateYearly").text(rate >= 0 ? (("" + rate).toBanglaNumber() + "%") : "-");
        }).always(function () {
            unblockUI();
        });
    }

    function loadCentralDashboardData() {
        var isEnglish = (languageCode == "en");
        blockUI();
        $.getJSON("/api/dashboard/central-data", function (response) {
            var total = response.total + response.ascertain;
            var resolved = response.resolved;
            var rate = 0;
            var appealResolveRate = 0;
            if(total > 0) {
                var result = (resolved / total) * 100;
                rate = Math.round(result * 100) / 100;
            }

            if(response.totalAppeal > 0){
                var result = (response.resolvedAppeal/response.totalAppeal)*100;
                appealResolveRate = Math.round(result * 100) / 100;
            }
            $("#totalGrievance").text(("" + response.total).toBanglaNumber());
            $("#timeExpiredGrievance").text(("" + response.timeExpiredComplaints).toBanglaNumber());
            $("#lastMonthAscertain").text(("" + response.ascertain).toBanglaNumber());
            $("#resolvedGrievance").text(("" + resolved).toBanglaNumber());
            $("#totalAppeal").text(("" + response.totalAppeal).toBanglaNumber());
            $("#timeExpiredAppeal").text(("" + response.timeExpiredAppeal).toBanglaNumber());
            $("#resolvedAppeal").text(("" + response.resolvedAppeal).toBanglaNumber());
            $("#grievanceResolveRate").text(("" + rate).toBanglaNumber());
            $("#appealResolveRate").text(("" + appealResolveRate).toBanglaNumber());

            var grievanceList = response.grievanceListDTO;
            var tbody = "";
            var rowTitle = isEnglish ? "Click to view count by offices" : "দপ্তর অনুযায়ী সেবাটির অভিযোগ সংখ্যা দেখতে ক্লিক করুন";
            if(grievanceList.length > 0) {
                grievanceList.forEach(function (item, index) {
                    tbody += "<tr data-id='" + item.id + "' title='" + rowTitle + "' data-toggle='tooltip' style='cursor:pointer;'>" +
                        "<td class='text-center'>" + ("" + (index + 1)).toBanglaNumber() + "</td>" +
                        "<td class='service-name'>" + item.name + "</td>" +
                        "<td class='text-center'>" + ("" + item.grievanceCount).toBanglaNumber() + "</td>" +
                        "</tr>";
                });
            } else {
                tbody = getTableNoDataFoundRow(3);
            }
            var tbodyDom = $("table.top-n-grievances tbody");
            tbodyDom.empty().html(tbody);
            tbodyDom.find("[data-toggle='tooltip']").tooltip();
        }).always(function () {
            unblockUI();
        });
    }

    function viewServicesGrievenceCountByOffices() {
        $("table.top-n-grievances tbody").off("click", "tr").on("click", "tr", function () {
            var _this = $(this),
                serviceId = _this.attr("data-id"),
                serviceName = _this.find("td.service-name").text(),
                isEnglish = (languageCode == "en"),
                tbody = "";
            $.ajax({
                url: "/api/dashboard/central-dashboard/services/" + serviceId + "/count-by-office",
                type: "GET",
                dataType: "json",
                success: function(response) {
                    if(response && response.length > 0) {
                        response.forEach(function (item, index) {
                            tbody += "<tr data-id='" + item.id + "'>" +
                                "<td class='text-center'>" + ("" + (index + 1)).toBanglaNumber() + "</td>" +
                                "<td class='text-center office-name'>" + item.name + "</td>" +
                                "<td class='text-center'>" + ("" + item.grievanceCount).toBanglaNumber() + "</td>" +
                                "</tr>";
                        });
                    } else {
                        tbody = getTableNoDataFoundRow(3);
                    }
                    var modal = $("#modalOfficeWiseGrievanceCountForService");
                    modal.find(".title-service-name").text(serviceName);
                    modal.find("table tbody").html($(tbody));
                    modal.modal("show");
                },
                beforeSend: function () {
                    blockUI();
                },
                complete: function () {
                    unblockUI();
                }
            });
        });
    }

    function showMinistryLevelOfficesStatistics() {
        $.ajax({
            url: "/api/dashboard/central-dashboard/count-by-all-ministries",
            type: "GET",
            dataType: "json",
            success: function(response) {
                var tbody = "";
                if(response && response.length > 0) {
                    response.forEach(function (item, index) {
                        var resolved = item.resolvedCount;
                        var total = item.totalCount;
                        var rate = item.rate;
                        tbody += "<tr id='officeId_" + item.officeId +"'>" +
                            "<td class='text-center'>" + ("" + (index + 1)).toBanglaNumber() + "</td>" +
                            "<td class='text-center'><a href='dashboard.do?params=" + encodeOfficeIdOnDrillDown(item.officeId) + "' class='clickable-link' title='ড্যাশবোর্ড দেখুন' data-toggle='tooltip'>" + item.officeName + "</a></td>" +
                            "<td class='text-center' style='background: #f7e1c5;'>" + ("" + total).toBanglaNumber() + "</td>" +
                            "<td class='text-center' style='background: #f7e1c5;'>" + ("" + rate).toBanglaNumber() + "</td>" +
                            "<td class='text-center' style='background: #f7e1c5;'>" + (total > 0 ? ("" + item.expiredCount).toBanglaNumber() : "0".toBanglaNumber()) + "</td>" +
                            "<td class='text-center sub-total-comp'><img src='assets/global/img/loading-spinner-blue.gif'></td>" +
                            "<td class='text-center sub-resolve-rate'><img src='assets/global/img/loading-spinner-blue.gif'></td>" +
                            "<td class='text-center sub-expired-comp'><img src='assets/global/img/loading-spinner-blue.gif'></td>" +
                            "</tr>";
                    });
                } else {
                    tbody = getTableNoDataFoundRow(3);
                }
                var tbodyDom = $("#ministryOfficesStatistics tbody");
                tbodyDom.empty().html($(tbody));
                tbodyDom.find("[data-toggle='tooltip']").tooltip();
            },
            beforeSend: function () {
                blockUI();
            },
            complete: function () {
                unblockUI();
                loadSubOfficeStatistics();
            }
        });
    }

    function loadSubOfficeStatistics(){
        $.ajax({
            url: "/api/dashboard/central-dashboard/subordinate-stat-all-ministries",
            type: "GET",
            dataType: "json",
            success: function(response) {
                response.forEach(function (item, index) {
                        var resolved = item.resolvedCount;
                        var total = item.totalCount;
                        var rate = item.rate;
                        $("#officeId_" + item.officeId + " .sub-total-comp").text(("" +total).toBanglaNumber());
                        $("#officeId_" + item.officeId + " .sub-resolve-rate").text(("" + rate).toBanglaNumber());
                        $("#officeId_" + item.officeId + " .sub-expired-comp").text(("" + item.expiredCount).toBanglaNumber());
                    });
            }
        });
    }
</script>