<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="includes/htmlhead :: htmlhead"></div>
    <div th:replace="fileUpload :: fileUploadIncludeStyle"></div>
</head>
<body class="page-container-bg-solid">
<div class="page-wrapper">
    <div th:replace="includes/header :: header(${menu})">...</div>

    <div class="page-wrapper-row full-height">
        <div class="page-wrapper-middle">
            <div class="page-container">
                <div class="page-content-wrapper" id="registrationPage">
                    <div class="page-body">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="main-box-div register" id="tab1">
                                        <form action="#" class="form-horizontal" id="registrationForm" method="POST" accept-charset="UTF-8">
                                            <div class="form-wizard" style="border-style: ridge;background: white;width: 100%;">
                                                <div class="" style="
                                                    background: #4f008c;
                                                    width: inherit;
                                                    height: 10px;
                                                    margin-bottom: 45px;
                                                "> </div>
                                                <div style="margin: 10px">
                                                    <h3 class="text-center bold" th:text="#{registration.form.complainant.info.title}" style="
                                                        color: #4f008c;
                                                        margin-bottom: 25px;
                                                    "></h3>
                                                    <div class="form-group">
                                                        <label class="control-label col-md-3" id="phoneNumberLabel"> <span th:text="#{registration.form.mobile}"></span><span class="required" aria-required="true">*</span></label>
                                                        <div class="col-md-8">
                                                            <input class="form-control" id="phoneNumber" name="phoneNumber" onblur="getUser();" type="text">
                                                        </div>
                                                    </div>

                                                    <div id="divRest">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-3" id="nameLabel" > <span th:text="#{registration.form.fullname}"></span><span class="required" aria-required="true">*</span></label>
                                                            <div class="col-md-8">
                                                                <input class="form-control" id="name" name="name" type="text">

                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <div class="">
                                                                <label class="control-label col-md-3" id="birthdateLabel" th:text="#{registration.form.birthdate}"></label>
                                                                <div class="col-md-3">
                                                                    <div class="input-group date" id="birthdate">
                                                                        <input class="form-control" data-date-end-date="0d" name="birthDate" type="text" readonly="readonly">
                                                                        <span class="input-group-addon">
                                                                            <i class="glyphicon glyphicon-calendar"></i>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="">
                                                                <label class="control-label col-md-2" id="genderLabel" th:text="#{registration.form.gender}"></label>
                                                                <div class="col-md-3">
                                                                    <select class="select2 form-control input-inline select2-hidden-accessible">
                                                                        <option selected="" style="display: none;" value="">জেন্ডার বাছাই করুন</option>
                                                                        <option name="gender" value="FEMALE" type="radio" th:text="#{registration.form.gender.female}">
                                                                        <option name="gender" value="MALE" type="radio" th:text="#{registration.form.gender.male}">
                                                                        <option name="gender" value="OTHER" type="radio" th:text="#{registration.form.gender.others}">
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <div class="">
                                                                <label class="control-label col-md-3" id="occupationLabel" th:text="#{registration.form.occupation}"></label>
                                                                <div class="col-md-3">
                                                                    <select class="select2 form-control input-inline select2-hidden-accessible" id="occupation" name="occupation" tabindex="-1" aria-hidden="true">
                                                                        <option selected="" style="display: none;" value="" th:text="#{choose.occupation.type}"></option>
                                                                        <option th:value="#{occupation.type.business}" th:text="#{occupation.type.business}"></option>
                                                                        <option th:value="#{occupation.type.govt.service}" th:text="#{occupation.type.govt.service}"></option>
                                                                        <option th:value="#{occupation.type.private.service}" th:text="#{occupation.type.private.service}"></option>
                                                                        <option th:value="#{occupation.type.retired}" th:text="#{occupation.type.retired}"></option>
                                                                        <option th:value="#{occupation.type.housewife}" th:text="#{occupation.type.housewife}"></option>
                                                                        <option th:value="#{occupation.type.student}" th:text="#{occupation.type.student}"></option>
                                                                        <option th:value="#{occupation.type.others}" th:text="#{occupation.type.others}"></option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="">
                                                                <label class="control-label col-md-2" id="educationLabel" th:text="#{registration.form.education}"></label>
                                                                <div class="col-md-3">
                                                                    <select class="select2 form-control input-inline select2-hidden-accessible" id="education" name="education" tabindex="-1" aria-hidden="true">
                                                                        <option selected="" style="display: none;" value="" th:text="#{choose.education.level}"></option>
                                                                        <option th:value="#{education.type.illiterate}" th:text="#{education.type.illiterate}"></option>
                                                                        <option th:value="#{education.type.literate}" th:text="#{education.type.literate}"></option>
                                                                        <option th:value="#{education.type.pec}" th:text="#{education.type.pec}"></option>
                                                                        <option th:value="#{education.type.jsc}" th:text="#{education.type.jsc}"></option>
                                                                        <option th:value="#{education.type.ssc}" th:text="#{education.type.ssc}"></option>
                                                                        <option th:value="#{education.type.hsc}" th:text="#{education.type.hsc}"></option>
                                                                        <option th:value="#{education.type.honors}" th:text="#{education.type.honors}"></option>
                                                                        <option th:value="#{education.type.masters}" th:text="#{education.type.masters}"></option>
                                                                        <option th:value="#{education.type.phd}" th:text="#{education.type.phd}"></option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <div class="col-md-3" style="text-align: right;">
                                                                <select name="identificationType" class="form-control display-inline-block width200" id="identificationSelect" tabindex="-1" aria-hidden="true" style="width: 90%;">
                                                                    <option value="NID" th:text="#{registration.form.nid}" selected></option>
                                                                    <option value="BCN" th:text="#{registration.form.birthcertificate}"></option>
                                                                    <option value="PASSPORT" th:text="#{registration.form.passport}"></option>
                                                                </select>
                                                                <span class="required" aria-required="true">*</span>
                                                            </div>

                                                            <div class="col-md-8">
                                                                <input class="form-control" id="identificationValue" name="identificationValue" type="text">
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="control-label col-md-3" id="emailLabel"> <span th:text="#{registration.form.email}"></span><span class="required" id="emailRequired" aria-required="true">*</span></label>
                                                            <div class="col-md-8">
                                                                <input class="form-control" id="email" name="email" type="text">
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <div class="">
                                                                <label class="col-md-3 control-label"><th:block th:text="#{country}"></th:block></label>
                                                                <div class="col-md-3">
                                                                    <select id="permanentAddressCountry" name="permanentAddressCountryId" class="select2 form-control input-inline select2-hidden-accessible" tabindex="-1" aria-hidden="true"></select>
                                                                </div>
                                                            </div>

                                                            <div>
                                                                <label class="col-md-2 control-label" th:text="#{registration.form.nationality}"></label>
                                                                <div class="col-md-3">
                                                                    <select id="nationality" name="nationality" class="select2 form-control input-inline select2-hidden-accessible" tabindex="-1" aria-hidden="true"></select>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div id="foreignPermanentAddress">
                                                            <div class="form-group">
                                                                <label class="col-md-3 control-label" id="foreignPermanentAddressLine1Label"> <th:block th:text="#{address.single.line}"></th:block><span class="required" aria-required="true">*</span></label>
                                                                <div class="col-md-8">
                                                                    <input class="form-control" id="foreignPermanentAddressLine1" name="foreignPermanentAddressLine1" type="text">
                                                                </div>
                                                                <span style="color: red;clear:both;"></span>
                                                                <br />
                                                                <br />
                                                                <label class="col-md-3 control-label hide" id="foreignPermanentAddressLine2Label"><th:block th:text="#{address.single.line}"></th:block><span class="required" aria-required="true">*</span></label>
                                                                <div class="col-md-8 col-md-offset-3">
                                                                    <input class="form-control" id="foreignPermanentAddressLine2" name="foreignPermanentAddressLine2" type="text">
                                                                </div>
                                                                <span style="color: red;"></span>
                                                            </div>
                                                        </div>

                                                        <div id="bdPermanentAddress">
                                                            <div class="form-group">
                                                                <label class="col-md-3 control-label" id="permanentAddressHouseLabel"><span th:text="#{address.single.line}"></span><span class="required" aria-required="true">*</span></label>
                                                                <div class="col-md-8">
                                                                    <input class="form-control" id="permanentAddressHouse" name="permanentAddressHouse" type="text">
                                                                </div>
                                                                <span style="color: red;clear:both;"></span>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-md-3 control-label hide" id="permanentAddressStreetLabel"><span class="required" aria-required="true">*</span></label>
                                                                <div class="col-md-8 col-md-offset-3">
                                                                    <input class="form-control" id="permanentAddressStreet" name="permanentAddressStreet" type="text">
                                                                </div>
                                                                <span style="color: red;"></span>
                                                            </div>

                                                            <!--<div class="form-group">
                                                                <label class="col-md-3 control-label"></label>
                                                                <div class="col-md-8">
                                                                    <div class="mt-radio-inline">
                                                                        <label class="mt-radio">
                                                                            <input checked="checked" name="permanentAddressTypeValue" value="UPAZILA" type="radio" th:text="#{registration.form.address.type.upazila}">
                                                                            <span></span>
                                                                        </label>
                                                                        <label class="mt-radio">
                                                                            <input name="permanentAddressTypeValue" value="CITY_CORPORATION" type="radio" th:text="#{registration.form.address.type.citycorporation}">
                                                                            <span></span>
                                                                        </label>
                                                                    </div>
                                                                    <div id="permanentAddressTypeValueDiv"></div>
                                                                </div>

                                                            </div>

                                                            <div class="form-group hide">
                                                                <label class="col-md-3 control-label" id="divisionLabel"><span class="required" aria-required="true">*</span>
                                                                </label>
                                                                <div class="col-md-3">
                                                                    <select class="select2 form-control select2-hidden-accessible" id="permanentAddressDivision" name="permanentAddressDivisionId" tabindex="-1" aria-hidden="true"></select>
                                                                </div>
                                                            </div>

                                                            <div class="form-group">
                                                                <div class="">
                                                                    <label class="col-md-3 control-label" id="districtLabel"><span th:text="#{registration.form.district}"></span><span class="required" aria-required="true">*</span>
                                                                    </label>
                                                                    <div class="col-md-3">
                                                                        <select class="select2 form-control select2-hidden-accessible" id="permanentAddressDistrict" name="permanentAddressDistrictId" tabindex="-1" aria-hidden="true"></select>
                                                                    </div>
                                                                </div>
                                                                <div class="">
                                                                    <label class="col-md-2 control-label" id="permanentAddressTypeIdLbl"><span th:text="#{registration.form.upazila}"></span><span class="required">*</span></label>
                                                                    <div class="col-md-3">
                                                                        <select class="select2 form-control select2-hidden-accessible" id="permanentAddressTypeId" name="permanentAddressTypeId" tabindex="-1" aria-hidden="true"></select>
                                                                    </div>
                                                                </div>

                                                            </div>-->
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-actions" id="btnRegister">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <buttton th:if="${fromGrievanceUpload == null || !fromGrievanceUpload}" id="buttonRegistration" class="btn green" href="#" onclick="javascript:registerComplainant(); " th:text="#{register}" style="
                                                                position: relative;
                                                                /* width: 20px; */
                                                                margin: 25px;
                                                                left: 47%;
                                                            "></buttton>
                                                            <buttton th:if="${fromGrievanceUpload != null && fromGrievanceUpload}" id="buttonRegistration" class="btn green" href="#" onclick="javascript:registerComplainantByGRO(); " th:text="#{register}" style="
                                                                position: relative;
                                                                /* width: 20px; */
                                                                margin: 25px;
                                                                left: 47%;
                                                            "></buttton>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="ajaxProcessingModal" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <img src="../assets/global/img/loading-spinner-grey.gif" alt="" class="loading">
                    <span th:text="#{processing}"> &nbsp;&nbsp; </span>
                </div>
            </div>
        </div>
    </div>


    <div th:replace="includes/footer :: footer">...</div>
</div>
<div th:replace="includes/footer_includes :: footer">...</div>
<script src="/assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
<script src="/assets/global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
<script src="/assets/global/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js" type="text/javascript"></script>
<script src="/assets/global/plugins/bootstrap-summernote/summernote.min.js" type="text/javascript"></script>
<script th:inline="javascript">
        var isFormSubmitted = false;
        var banglaToEnglishDigitMapping = {
              '০': 0,
              '১': 1,
              '২': 2,
              '৩': 3,
              '৪': 4,
              '৫': 5,
              '৬': 6,
              '৭': 7,
              '৮': 8,
              '৯': 9
        };

        function ajaxPut(url, accept, send, postData, onSuccess) {
            $.ajax({
                type: "PUT",
                url: url,
                dataType: accept,
                contentType: send,
                data: postData,
                success: onSuccess
            });
        }

        function convertFromBanglaNumToEnglish(input) {
              var output = [];
              for (var i = 0; i < input.length; ++i) {
                if (banglaToEnglishDigitMapping.hasOwnProperty(input[i])) {
                  output.push(banglaToEnglishDigitMapping[input[i]]);
                } else {
                  output.push(input[i]);
                }
              }
              return output.join('');
        }

        function showMessageHandler(result) {
            closeLoading();
            if (result.success) {
                showSuccess(result.message);
            } else {
                showError(result.message);
            }
        }

        function getComplainantDTO() {
            var array = $('#tab1 :input').serializeArray();
            var user = {};
            $.each(array, function() {
                user[this.name] = this.value || '';
            });

//            var permanentAddressDivision = $('#permanentAddressDivision :selected').data();
//            var permanentAddressDistrict = $('#permanentAddressDistrict :selected').data();
//            var permanentAddressTypeId = $('#permanentAddressTypeId :selected').data();



//            user['permanentAddressDivisionNameBng'] = permanentAddressDivision.nameBangla;
//            user['permanentAddressDivisionNameEng'] = permanentAddressDivision.nameEnglish;
//            user['permanentAddressDistrictNameBng'] = permanentAddressDistrict.nameBangla;
//            user['permanentAddressDistrictNameEng'] = permanentAddressDistrict.nameEnglish;
//            user['permanentAddressTypeNameBng'] = permanentAddressTypeId.nameBangla;
//            user['permanentAddressTypeNameEng'] = permanentAddressTypeId.nameEnglish;

            if(user['permanentAddressCountryId']=='15') {

                user['foreignPermanentAddressLine1']=null;
                user['foreignPermanentAddressLine2']=null;
//                user['foreignPermanentAddressCity']=null;
//                user['foreignPermanentAddressState']=null;
//                user['foreignPermanentAddressZipCode']=null;
            }
            else {

//                user['permanentAddressTypeValue']=null;
                user['permanentAddressHouse']=null;
                user['permanentAddressStreet']=null;
//                user['permanentAddressDivisionId']=null;
//                user[''] = null;
//                user[''] = null;

//                user['permanentAddressDistrictId']=null;
//                user[''] = null;
//                user[''] = null;

//                user['permanentAddressTypeId']=null;
//                user[''] = null;
//                user[''] = null;
//
//                user['permanentAddressPostalCode']=null;
            }

            var user = JSON.stringify(user);
            return user;
        }

        function onRegistrationSuccess(result) {
            closeLoading();
            isFormSubmitted = true;
            showSuccess(result.message);
            window.setTimeout(function() {
                var oldLink = window.location.href;
                if(oldLink.includes("mobile")){
                    oldLink = oldLink.replace("mobileRegistration.do", "login?a=0");
                } else {
                    oldLink = oldLink.replace("register.do", "login?a=0&redirectUrl=addPublicGrievances.do");
                }
                window.location.href = oldLink;
            }, 1500);
        }

        function onRegistrationByGROSuccess(result) {
            closeLoading();
            isFormSubmitted = true;
            showSuccess(result.message);
            window.setTimeout(function() {
                window.location.href = "/addPublicGrievancesByGRO.do?phone=" + result.phone;
            }, 1500);
        }

        function registerComplainantByGRO(){
            $("#buttonRegistration").attr("disabled",true);
            $("#btnRegister").hide(function(){
                var form = validateForm (($('#nationality').val()!='15'));
                if (form.valid() == false) {
                    $("#btnRegister").show();
                    $("#buttonRegistration").attr("disabled", false);
                    return;
                } else {
                    //$("#btnRegister").hide();
                }
                window.onbeforeunload = null;
                showLoading();
                var user = getComplainantDTO();

                ajaxPost("/register/gro", "json", "application/json", user, onRegistrationByGROSuccess);
            });
        }

        function registerComplainant() {
            $("#buttonRegistration").attr("disabled",true);
            $("#btnRegister").hide(function(){
                var form = validateForm (($('#nationality').val()!='15'));
                if (form.valid() == false) {
                    $("#btnRegister").show();
                    $("#buttonRegistration").attr("disabled", false);
                    return;
                } else {
                    //$("#btnRegister").hide();
                }
                window.onbeforeunload = null;
                showLoading();
                var user = getComplainantDTO();
                ajaxPost("/register", "json", "application/json", user, onRegistrationSuccess);
            });
        }

        function populateNationalityCountry(data) {
            $("#nationality").empty();
            $("#permanentAddressCountry").empty();

            $.each(data, function(i, field) {
                if (jsLangCodeForLibs == "en") {
                    $("#nationality").append(new Option(field.nationalityEng, field.id));
                    $("#permanentAddressCountry").append(new Option(field.countryNameEng, field.id));
                } else {
                    $("#nationality").append(new Option(field.nationalityBng, field.id));
                    $("#permanentAddressCountry").append(new Option(field.countryNameBng, field.id));
                }
            });

            $("#nationality").val('15');
            $("#permanentAddressCountry").val('15');

            $("#nationality").trigger('change');

            $("#permanentAddressCountry").trigger('change');
        }

        function populateOccupationsList(data) {
            $("#occupation").empty();
            if (jsLangCodeForLibs == "en") {
                $("#occupation").append(new Option("--Choose your occupation--", ""));
            } else {
                $("#occupation").append(new Option("--পেশা বাছাই করুন--", ""));
            }

            $.each(data, function(i, field) {
                if (jsLangCodeForLibs == "en") {
                    $("#occupation").append(new Option(field.occupationEnglish, field.occupationEnglish));
                } else {
                    $("#occupation").append(new Option(field.occupationBangla, field.occupationBangla));
                }
            });
            $("#occupation").trigger('change');
        }

        function populateEducationalQualificationsList(data) {
            $("#education").empty();
            if (jsLangCodeForLibs == "en") {
                $("#education").append(new Option("--Choose your education level--", ""));
            } else {
                $("#education").append(new Option("--শিক্ষাগত যোগ্যতা বাছাই করুন--", ""));
            }

            $.each(data, function(i, field) {
                if (jsLangCodeForLibs == "en") {
                    $("#education").append(new Option(field.educationEnglish, field.educationEnglish));
                } else {
                    $("#education").append(new Option(field.educationBangla, field.educationBangla));
                }
            });
            $("#education").trigger('change');
        }

        function init() {
            $('#permanentAddressCountry').select2({
                width: '208px',
                placeholder: "Select Country",
                language: jsLangCodeForLibs
            });

            $('#nationality').select2({
                width: '200px',
                placeholder: "Select Nationality",
                language: jsLangCodeForLibs
            });

            $("#birthdate").datepicker({
                format: "dd/mm/yyyy",
                startView: 2,
                autoclose: true,
                language: jsLangCodeForLibs,
                endDate: "-4745d",
                beforeShowDay: function(date){
                    if (jsLangCodeForLibs == "bn") {
                        var obj = {
                            "enabled": true,
                            "content" : ("" + date.getDate()).toBanglaNumber(),
                            "classes": "",
                            "tooltip": ""
                        };
                        return obj;
                    }
                },
                beforeShowYear: function(date){
                    if (jsLangCodeForLibs == "bn") {
                        var obj = {
                            "enabled": true,
                            "content" : ("" + date.getFullYear()).toBanglaNumber(),
                            "classes": "",
                            "tooltip": ""
                        };
                        return obj;
                    }
                },
                beforeShowDecade: function(date){
                    if (jsLangCodeForLibs == "bn") {
                        var obj = {
                            "enabled": true,
                            "content" : ("" + date.getFullYear()).toBanglaNumber(),
                            "classes": "",
                            "tooltip": ""
                        };
                        return obj;
                    }
                },
                beforeShowCentury: function(date){
                    if (jsLangCodeForLibs == "bn") {
                        var obj = {
                            "enabled": true,
                            "content" : ("" + date.getFullYear()).toBanglaNumber(),
                            "classes": "",
                            "tooltip": ""
                        };
                        return obj;
                    }
                }
            });

            $('.summernote').summernote({
                height: 100,
                toolbar: [
                    ['style', ['bold', 'italic', 'underline', 'clear', 'fontname']],
                    ['font', ['strikethrough', 'superscript', 'subscript']],
                    ['fontsize', ['fontsize']],
                    ['color', ['color']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['Insert', ['table', 'hr']],
                    ['Misc', ['undo', 'redo']]
                ]
            });

            $('.select2').select2({
                width: '208px',
                language: jsLangCodeForLibs
            });

            $('#nationality').on('change', function(){
                $("#identificationSelect").empty();
                if ($('#nationality').val()=='15') {
                    if (jsLangCodeForLibs == "bn") {
                        $("#identificationSelect").append(new Option("জাতীয় পরিচয়পত্র নম্বর", "NID"));
                        $("#identificationSelect").append(new Option("জন্মনিবন্ধন সনদ নম্বর", "BCN"));
                        $("#identificationSelect").append(new Option("পাসপোর্ট নম্বর", "PASSPORT"));
                    } else {
                        $("#identificationSelect").append(new Option("National ID", "NID"));
                        $("#identificationSelect").append(new Option("Birth certificate number", "BCN"));
                        $("#identificationSelect").append(new Option("Passport number", "PASSPORT"));
                    }
                    $("#emailRequired").hide();
                }
                else {
                    if (jsLangCodeForLibs == "bn") {
                        $("#identificationSelect").append(new Option("পাসপোর্ট নম্বর", "PASSPORT"));
                    } else {
                        $("#identificationSelect").append(new Option("Passport number", "PASSPORT"));
                    }
                    $("#emailRequired").show();
                }

            });


            $("#permanentAddressCountry").on('change', function(){
                if(this.value=='15') {
                    $('#bdPermanentAddress').show();
                    $('#foreignPermanentAddress').hide();
                }
                else {
                    $('#bdPermanentAddress').hide();
                    $('#foreignPermanentAddress').show();
                }
            });

            getJson("/api/geo/countries", populateNationalityCountry);
            getJson("/api/occupations", populateOccupationsList);
            getJson("/api/educations", populateEducationalQualificationsList);
        }

        function hideAddressDiv() {
            $("#bdPermanentAddress").hide();
            $("#foreignPermanentAddress").hide();
        }

        function adjustUpazilaLabel(labelId) {
            var lang = getCookie("lang");
            var contentHouse = (lang=="en"?"Address":"ঠিকানা");
            var contentStreet = (lang=="en"?"Address":"ঠিকানা");

            if (labelId.startsWith("permanent")) {
                $('#permanentAddressHouseLabel').empty();
                $('#permanentAddressHouseLabel').append(contentHouse);
                $('#permanentAddressHouseLabel').append("<span class=\"required\">*</span>");

                $('#permanentAddressStreetLabel').empty();
                $('#permanentAddressStreetLabel').append(contentStreet);
                $('#permanentAddressStreetLabel').append("<span class=\"required\">*</span>");
            }
        }

        function adjustCityCorporationLabel(labelId) {
            var lang = getCookie("lang");
            var contentHouse = (lang=="en"?"Address":"ঠিকানা");
            var contentStreet = (lang=="en"?"Address":"ঠিকানা");

            if (labelId.startsWith("permanent")) {
                $('#permanentAddressHouseLabel').empty();
                $('#permanentAddressHouseLabel').append(contentHouse);
                $('#permanentAddressHouseLabel').append("<span class=\"required\">*</span>");

                $('#permanentAddressStreetLabel').empty();
                $('#permanentAddressStreetLabel').append(contentStreet);
                $('#permanentAddressStreetLabel').append("<span class=\"required\">*</span>");
            }
        }

        /*function updateLabelOfEndPoint(labelId, typeValue) {
            var lbl = $("#"+labelId);
            lbl.empty();
            var lang = getCookie("lang");

            switch(typeValue){
                case "UPAZILA":
                    var content = (lang=="en"?"Upazilla":"উপজেলা");
                    lbl.append(content);
                    lbl.append("<span class=\"required\">*</span>");
                    adjustUpazilaLabel(labelId);
                    break;

                case "CITY_CORPORATION":
                    var content = (lang=="en"?"City corporation":"সিটি কর্পোরেশন");
                    lbl.append(content);
                    lbl.append("<span class=\"required\">*</span>");
                    adjustCityCorporationLabel(labelId);
                    break;
            }
        }*/

        function sortObjectsByProperty(objectList, propName) {
            return objectList.sort(function(a,b) {
                return a[propName].trim().replace(" ", "") > b[propName].trim().replace(" ", "") ? 1 : -1;
            });
        }

        /*function onUpazilaCityCorporationRadioSelectionChange(typeValue, addressType) {
            var district = "#"+addressType+"AddressDistrict";
            var division = "#"+addressType+"AddressDivision";
            var isEnglish = (languageCode == "en"),
                propName = isEnglish ? "nameEnglish" : "nameBangla";
            switch(typeValue) {
                case "UPAZILA":
                    var upazila = "#"+addressType+"AddressTypeId";
                    $("#permanentAddressTypeIdLbl").removeClass("col-md-3");
                    $("#permanentAddressTypeIdLbl").addClass("col-md-2");
                    $(district).change(function() {
                        var districtId = this.value;

                        $(upazila).empty();
                        $(upazila).select2("destroy");
                        $(upazila).off('change');
                        getJson("/api/geo/upazilas/"+districtId, function(result) {
                            $(upazila).empty();
                            sortObjectsByProperty(result, propName);
                            $.each(result, function(i, field) {
                                if (languageCode == "en") {
                                    var opt = new Option(field.nameEnglish, field.id);
                                    $(opt).data(field);
                                    $(upazila).append(opt);
                                } else {
                                    var opt = new Option(field.nameBangla, field.id);
                                    $(opt).data(field);
                                    $(upazila).append(opt);
                                }
                            });

                        });
                        $(upazila).select2({width: '208px'});

                        $(division).empty();
                        $(division).select2("destroy");
                        getJson("/api/geo/division/"+ districtId, function(field) {
                            if (languageCode == "en") {
                                var opt = new Option(field.nameEnglish, field.id);
                                $(opt).data(field);
                                $(division).append(opt);
                            } else {
                                var opt = new Option(field.nameBangla, field.id);
                                $(opt).data(field);
                                $(division).append(opt);
                            }
                        });
                        $(division).select2({width: '208px'});
                    });
                    $(district).parent().parent().removeClass("hide");
                    $(district).empty();
                    $(district).select2("destroy");
                    getJson("/api/geo/districts", function(result){
                        sortObjectsByProperty(result, propName);
                        $.each(result, function(i, field) {
                            if (languageCode == "en") {
                                var opt = new Option(field.nameEnglish, field.id);
                                $(opt).data(field);
                                $(district).append(opt);
                            } else {
                                var opt = new Option(field.nameBangla, field.id);
                                $(opt).data(field);
                                $(district).append(opt);
                            }
                        });

                        $(district).change();
                    });
                    $(district).select2({width: '208px'});
                break;

                case "CITY_CORPORATION":
                    var cityCorporation = "#"+addressType+"AddressTypeId";
                    $("#permanentAddressTypeIdLbl").removeClass("col-md-2");
                    $("#permanentAddressTypeIdLbl").addClass("col-md-3");
                    $(district).off("change");
                    $(district).parent().parent().addClass("hide");
                    $(cityCorporation).change(function() {
                         var cityCorporationId = this.value;
                         $(district).empty();
                         $(district).select2("destroy");
                         $(division).empty();
                         $(division).select2("destroy");
                         getJson("/api/geo/citycorporation/division/"+cityCorporationId, function(field){
                            if (languageCode == "en") {
                                var opt = new Option(field.nameEnglish, field.id);
                                $(opt).data(field);
                                $(division).append(opt);
                            } else {
                                var opt = new Option(field.nameBangla, field.id);
                                $(opt).data(field);
                                $(division).append(opt);
                            }
                         });
                         $(division).select2({width: '208px'});
                         getJson("/api/geo/citycorporation/district/"+cityCorporationId, function(field){
                            if (languageCode == "en") {
                                var opt = new Option(field.nameEnglish, field.id);
                                $(opt).data(field);
                                $(district).append(opt);
                            } else {
                                var opt = new Option(field.nameBangla, field.id);
                                $(opt).data(field);
                                $(district).append(opt);
                            }
                         });
                         $(district).select2({width: '208px'});
                    });

                    $(cityCorporation).empty();
                    $(cityCorporation).select2("destroy");
                    getJson("/api/geo/citycorporations", function(result){
                        sortObjectsByProperty(result, propName);
                        $.each(result, function(i, field) {
                            if (languageCode == "en") {
                                var opt = new Option(field.nameEnglish, field.id);
                                $(opt).data(field);
                                $(cityCorporation).append(opt);
                            } else {
                                var opt = new Option(field.nameBangla, field.id);
                                $(opt).data(field);
                                $(cityCorporation).append(opt);
                            }
                        });

                        $(cityCorporation).change();
                    });
                    $(cityCorporation).select2({width: '208px'});
                break;
            }
        }*/

        /*function doProcess() {

            $('input[type=radio][name=permanentAddressTypeValue]').change(function() {
                var typeValue = $('input[type=radio][name=permanentAddressTypeValue]:checked').val();
                updateLabelOfEndPoint('permanentAddressTypeIdLbl', typeValue);
                onUpazilaCityCorporationRadioSelectionChange(typeValue, 'permanent');
            });

            $('input[type=radio][name=permanentAddressTypeValue]:checked').change();

        };*/

        function ajaxPost(url, accept, send, postData, onSuccess) {
            $.ajax({
                type: "POST",
                url: url,
                dataType: accept,
                contentType: send,
                data: postData,
                success: onSuccess,
                error: function(jqXHR, exception) {
                    showError("Sorry, Something Went Wrong. Try again later.");
                    console.log(jqXHR);
                    console.log(exception);
                }
            });
        }

        function Login() {
            $.post("/login?username=" + convertFromBanglaNumToEnglish($("#phoneNumber").val()) + "&password=" + $("#pinNumber").val(), function(data) {

                var auth = getCookie('Authorization');
                closeLoading();
                if (auth != "") {
                    var oldLink = window.location.href;
                    oldLink = oldLink.replace("register.do", "addPublicGrievances.do");
                    window.location.href = oldLink;
                }
                else {
                    showError("সঠিক পাসওয়ার্ড প্রদান করুন");
                }
            }).always(function() {
                closeLoading();
            });
        }

        function getJson(url, onGettingJson) {
            $.getJSON(url, onGettingJson);
        }

        function getUser() {
            var phoneNumber = convertFromBanglaNumToEnglish($("#phoneNumber").val());
            getJson("/api/complainant/" + phoneNumber, checkIfUserExist);
        }

        function checkIfUserExist(data) {
            window.onbeforeunload = null;
            var phoneNumber =  $("input[name='phoneNumber']").val();
            if (data.success == false) {
                $("#divRest").css('display', 'block');
                $("#btnRegister").removeClass("hide");
                window.onbeforeunload = function() {
                    return true;
                };
            } else {
                /*<![CDATA[*/
                    var registrationByGRO = /*[[${fromGrievanceUpload}]]*/ false;
                /*]]>*/
                if(registrationByGRO){
                    swal({
                      title: "নিবন্ধিত অভিযোগকারী",
                      text: "আপনার প্রদানকৃত মোবাইল নম্বর দিয়ে পূর্বেই নিবন্ধন করা করা আছে",
                      type: "info",
                      showCancelButton: true,
                      confirmButtonClass: "btn-success",
                      confirmButtonText: "অভিযোগ আপলোড ফর্মে যান ",
                      cancelButtonText: "বাতিল",
                      closeOnConfirm: false,
                      closeOnCancel: false
                    },
                    function(isConfirm) {
                      if (isConfirm) {
                            window.location.href = "/addPublicGrievancesByGRO.do?phone=" + data.phoneNumber;
                      } else {
                          swal.close();
                          $("input[name='phoneNumber']").val('').focus();
                      }
                    });
                } else{
                    swal({
                      title: "নিবন্ধিত অভিযোগকারী",
                      text: "আপনার প্রদানকৃত মোবাইল নম্বর দিয়ে পূর্বেই নিবন্ধন করা করা আছে, অনুগ্রহ করে লগইন করুন",
                      type: "info",
                      showCancelButton: true,
                      confirmButtonClass: "btn-success",
                      confirmButtonText: "লগইন",
                      cancelButtonText: "বাতিল",
                      closeOnConfirm: false,
                      closeOnCancel: false
                    },
                    function(isConfirm) {
                      if (isConfirm) {
                            window.location.href = "/login?a=0&redirectUrl=addPublicGrievances.do&phoneNumber=" + phoneNumber;
                      } else {
                          swal.close();
                          $("input[name='phoneNumber']").val('').focus();
                      }
                    });
                }

                $("#divRest").css('display', 'block');
                $("#btnRegister").removeClass("hide");
            }
        }

        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function getOfficeName() {
            var officeName = "";
            if ($("#thirdSelection").data('select2')) {
                officeName = $("#thirdSelection option:selected").text();
            } else if ($("#secondSelection").data('select2')) {
                officeName = $("#secondSelection option:selected").text()
            } else if ($("#firstSelection").data('select2')) {
                officeName = $("#firstSelection option:selected").text()
            }
            return officeName;
        }

        function showSuccess(msg) {
            toastr.success(msg);
        }

        function showError(msg) {
            toastr.error(msg);
        }

        function showLoading() {
            $("#ajaxProcessingModal").modal('show');
        }

        function closeLoading() {
            $("#ajaxProcessingModal").modal('hide');
        }

        function loadConfirmationTab(){
            var selectedServiceName = $("#serviceDropDown option:selected").text();
            var selectedServiceId = $("#serviceDropDown").val();
            if (selectedServiceId == 0) {
                selectedServiceName = $("#serviceOthers").val();
            }

            var strPermanentAddress = $("#permanentAddressHouse").val() + "<br />";
                strPermanentAddress += $("#permanentAddressStreet").val() + "<br />";
                strPermanentAddress += $("#permanentAddressTypeId option:selected").text() + ", ";
                strPermanentAddress += $("#permanentAddressDistrict option:selected").text() + ", ";
                strPermanentAddress += $("#permanentAddressDivision option:selected").text();

            var files = new Array();
            $("#divFileUpload").contents().find("td p.name a").each(function() {
                var name = $(this).attr("href");
                files.push(name);
            });

            $("#previewOfficeName").html(getOfficeName());
            $("#previewSubject").html($("#subject").val());
            $("#previewServiceName").html(selectedServiceName);
            $("#previewServiceDate").html($("input[name=submissionDate]").val());
            $("#previewServiceTrackingNumber").html($("#serviceTrackingNumber").val());
            $("#previewDescription").html($("#body").summernote("code"));
            $("#previewName").html($("#name").val());
            $("#previewMobileNumber").html($("#phoneNumber").val());
            $("#previewEmail").html($("#email").val());
            $("#previewNid").html($("#nidOrBcn").val());
            $("#previewGender").html($("input[name='gender']:checked").parent('label').text().replace(/\s/g, ''));
            $("#previewBirthdate").html($("input[name=birthDate]").val());
            $("#previewOccupation").html($("#occupation option:selected").text());
            $("#previewEducation").html($("#education option:selected").text());

            $("#previewServiceReceivedBy").html($("#serviceReceiver").val() + " (" + $("input[name='relation']:checked").parent('label').text() + ")");
            $("#previewPermanentAddress").html(strPermanentAddress);

            if (files.length > 0) {
	            var strFilesContent = "";
                $.each(files, function( index, value ) {
                    strFilesContent += '' +
                    '<li class="mt-list-item">' +
                        '<div class="list-icon-container">' +
                            '<i class="icon-paper-clip"></i>' +
                        '</div>' +
                        '<div class="list-datetime"> &nbsp;</div>' +
                        '<div class="list-item-content">' +
                            '<h3 class="uppercase">' +
                                '<a target="_blank" href="' + value + '">' + (index+1) + '</a>' +
                            '</h3>' +
                        '</div>' +
                    '</li>';
                });

                $("#previewAttachedFilesList").html(strFilesContent);
            } else {
                $("#previewAttachedFilesList").next().show().remove();
            }
        }

      function validateForm (isEmailRequired) {
            var form = $('#registrationForm');
            var error = $('.alert-danger', form);
            var success = $('.alert-success', form);
            var requiredText = "";
            var min = 0;
            var max = 0;
            var nidBCPass = $("#identificationSelect").val();

            if (languageCode == "en") {
                requiredText = "This field is required";
            } else {
                requiredText = "এই তথ্যটি প্রদান করা আবশ্যক";
            }

            if(nidBCPass == "PASSPORT") {
                min = 9;
                max = 9;
            } else if(nidBCPass == "BCN") {
                min = 17;
                max = 17;
            } else if(nidBCPass == "NID") {
                min = 10;
                max = 17;
            }

            var minBng = (min+"").toBanglaNumber();
            var maxBng = (max+"").toBanglaNumber();

            form.validate().destroy();
            jQuery.validator.addMethod("regex", function(value, element, regexPattern) {
                console.log(element.id);
                if (element.id=="phoneNumber") {
                    value = convertFromBanglaNumToEnglish(value);
                }
                return this.optional( element ) || regexPattern.test(value);
            }, 'অনুগ্রহ করে যথাযথ ভ্যালু সরবরাহ করুন');

            form.validate({
                doNotHideMessage: true,
                errorElement: 'span',
                errorClass: 'help-block help-block-error',
                focusInvalid: false,
                rules: {
                    phoneNumber: {
                        minlength: 11,
                        maxlength: 11,
                        required: true,
                        regex: /^[0][1][5-9]\d{8}$/
                    },
                    pinNumber: {
                        minlength: 6,
                        required: true
                    },
                    name: {
                        minlength: 3,
                        required: true
                    },
                    identificationValue: {
                        minlength: min,
                        maxlength: max,
                        required: true,
                        regex: /([a-zA-Z]{2}\d{7})|(\d{17})|(\d{10})|(\d{13})|([০-৯]{17})|([০-৯]{10})|([০-৯]{13})|([a-zA-Z]{2}[0-9০-৯]{7})$/
                    },
                    nidOrBcn: {
                        required: true
                    },
                    permanentAddressHouse: {
                        required: true
                    },
                    foreignPermanentAddressLine1: {
                        required: true
                     },
                    email: {
                       required: isEmailRequired,
                       email: true
                    },
                    permanentAddressPostalCode: {
                        required: false,
                        regex: /((\d{4})|([০-৯]{4}))$/
                    }
                },

                messages: {
                    phoneNumber: {
                        minlength: jQuery.validator.format("কমপক্ষে ১১ সংখ্যা প্রয়োজন"),
                        maxlength: jQuery.validator.format("সর্বোচ্চ ১১ সংখ্যা প্রদান করুন"),
                        required: requiredText,
                        regex: "অনুগ্রহ করে সঠিক ফোন নম্বর প্রদান করুন"
                    },
                    pinNumber: {
                        required: requiredText
                    },
                    name: {
                        required: requiredText
                    },
                    identificationValue: {
                        minlength: jQuery.validator.format("কমপক্ষে "+minBng+" অক্ষর/সংখ্যা প্রয়োজন"),
                        maxlength: jQuery.validator.format("সর্বোচ্চ "+maxBng+" অক্ষর/সংখ্যা প্রদান করুন"),
                        required: requiredText
                    },
                    nidOrBcn: {
                        required: requiredText
                    },
                    permanentAddressHouse: {
                        required: requiredText
                    },

                    foreignPermanentAddressLine1: {
                        required: requiredText
                    },
                    email: {
                        required: requiredText
                    }
                },

                errorPlacement: function(error, element) {
                    if (element.attr("name") == "permanentAddressTypeValue") {
                        error.insertAfter("#permanentAddressTypeValueDiv");
                    } else {
                        error.insertAfter(element);
                    }
                },

                invalidHandler: function(event, validator) {
                    success.hide();
                    error.show();
                    App.scrollTo(error, -200);
                },

                highlight: function(element) {
                    $(element).closest('.form-group').removeClass('has-success').addClass('has-error');
                },

                unhighlight: function(element) {
                    $(element).closest('.form-group').removeClass('has-error');
                },

                success: function(label) {
                    label.addClass('valid').closest('.form-group').removeClass('has-error').addClass('has-success');
                },

                submitHandler: function(form) {
                    success.show();
                    error.hide();
                }
            });
            return form;
      }

      $(document).ready(function() {
            init();
            hideAddressDiv();
//            doProcess();


            window.onbeforeunload = function() {
                return true;
            };

            $('#serviceDropDown').on('change', function(e){
                if ($(this).val() == "0") {
                    $('#serviceOthers').removeClass('hide');
                } else {
                    $('#serviceOthers').val('');
                    $('#serviceOthers').addClass('hide');
                }
            });

            $("#identificationValue").blur(function(e){
                e.preventDefault();
                $(this).closest('.form-group').removeClass("has-error");
                $("#identificationValue-error").remove();
                if ($("#identificationSelect").val() == "NID") {
                    if ($(this).val().trim().length != 10 && $(this).val().trim().length != 13 && $(this).val().trim().length != 17) {
                        $(this).closest('.form-group').addClass("has-error");
                        if (jsLangCodeForLibs == "en") {
                            $(this).after('<span id="identificationValue-error" class="help-block help-block-error" style="display: block;">National ID must be either 10, 13 or 17 digits</span>');
                        } else {
                            $(this).after('<span id="identificationValue-error" class="help-block help-block-error" style="display: block;">জাতীয় পরিচয়পত্র নম্বর ১০, ১৩ অথবা ১৭ অংকের সংখ্যা হতে হবে</span>');
                        }
                    }
                } else if ($("#identificationSelect").val() == "BCN") {
                    if ($(this).val().trim().length != 17) {
                        $(this).closest('.form-group').addClass("has-error");
                        if (jsLangCodeForLibs == "en") {
                            $(this).after('<span id="identificationValue-error" class="help-block help-block-error" style="display: block;">Birth certificate number must be 17 digits</span>');
                        } else {
                            $(this).after('<span id="identificationValue-error" class="help-block help-block-error" style="display: block;">জন্মনিবন্ধন সনদ নম্বর ১৭ অংকের সংখ্যা হতে হবে</span>');
                        }
                    }
                } else {
                    if ($(this).val().trim().length != 9) {
                        $(this).closest('.form-group').addClass("has-error");
                        if (jsLangCodeForLibs == "en") {
                            $(this).after('<span id="identificationValue-error" class="help-block help-block-error" style="display: block;">Passport number must be 9 characters</span>');
                        } else {
                            $(this).after('<span id="identificationValue-error" class="help-block help-block-error" style="display: block;">পাসপোর্ট নম্বর ৯ অক্ষর হতে হবে</span>');
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
